\documentclass[onecolumn, draftclsnofoot,10pt, compsoc]{IEEEtran}
\usepackage{graphicx}
\graphicspath{ {images/} }
\usepackage{pdfpages}
\usepackage{url}
\usepackage{setspace}
\usepackage{listings}
\usepackage{color}
\usepackage{geometry}
\usepackage{float}
\usepackage{pgfgantt}
\usepackage{caption}

% For flow charts.
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows}

% Customizing flow chart components.
\tikzstyle{startstop} = [rectangle, rounded corners, minimum width=3cm, minimum height=1cm,text centered, draw=black, fill=red!30]
\tikzstyle{io} = [trapezium, trapezium left angle=70, trapezium right angle=110, minimum width=2cm, minimum height=1cm, text centered, draw=black, fill=blue!30]
\tikzstyle{process} = [rectangle, minimum width=3cm, minimum height=1cm, text centered, draw=black, fill=orange!30]
\tikzstyle{decision} = [diamond, minimum width=3cm, minimum height=1cm, text centered, draw=black, fill=green!30]
\tikzstyle{arrow} = [thick,->,>=stealth]



\geometry{textheight=9.5in, textwidth=7in}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{
	backgroundcolor=\color{white},
	basicstyle=\footnotesize,
	captionpos=b,
	frame=single,
	keywordstyle=\color{blue},
	language=HTML,
	numbers=left,
	numberstyle=\tiny\color{mygray},
	tabsize=2
}
	
	

% 1. Fill in these details
\def \CapstoneTeamName{		Stat Champs}
\def \CapstoneTeamNumber{		59}
\def \GroupMemberOne{			Alex Hoffer}
\def \GroupMemberTwo{			Chongxian Chen}
\def \GroupMemberThree{			Jacob Smith}
\def \CapstoneProjectName{		Machine Learn Your Way to March Madness Glory}
\def \CapstoneSponsorCompany{	Oregon State University}
\def \CapstoneSponsorPerson{		Dr. Victor Hsu}

% 2. Uncomment the appropriate line below so that the document type works
\def \DocType{		%Problem Statement
				%Requirements Document
				%Technology Review
				Progress Report
				}
			
\newcommand{\NameSigPair}[1]{\par
\makebox[2.75in][r]{#1} \hfil 	\makebox[3.25in]{\makebox[2.25in]{\hrulefill} \hfill		\makebox[.75in]{\hrulefill}}
\par\vspace{-12pt} \textit{\tiny\noindent
\makebox[2.75in]{} \hfil		\makebox[3.25in]{\makebox[2.25in][r]{Signature} \hfill	\makebox[.75in][r]{Date}}}}
% 3. If the document is not to be signed, uncomment the RENEWcommand below
\renewcommand{\NameSigPair}[1]{#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\pagenumbering{arabic}
\begin{centering}
\huge
Final Report \\
\Large 
\textbf{Name:} Alex Hoffer, Chongxian Chen, Jacob Smith \\
\textbf{Group Number:} 59 \\
\textbf{Project Title:} Machine Learn Your Way to March Madness Glory! \\
\end{centering}
%\begin{titlepage}
%\pagenumbering{gobble}
 \begin{singlespace}
   % 	\includegraphics[height=4cm]{coe_v_spot1}
    %    \hfill 
        % 4. If you have a logo, use this includegraphics command to put it on the coversheet.
        %\includegraphics[height=4cm]{CompanyLogo}   
     %   \par\vspace{.2in}
      %  \centering
 %       \scshape{
  %          \huge CS Capstone \DocType \par
   %         {\large\today}\par
    %        \vspace{.5in}
     %       \textbf{\Huge\CapstoneProjectName}\par
      %      \vfill
       %     {\large Prepared for}\par
        %    \Huge \CapstoneSponsorCompany\par
         %   \vspace{5pt}
          %  {\Large\NameSigPair{\CapstoneSponsorPerson}\par}
           % {\large Prepared by }\par
           % Group\CapstoneTeamNumber\par
            % 5. comment out the line below this one if you do not wish to name your team
         %   \CapstoneTeamName\par 
        %    \vspace{5pt}
       %     {\Large
      %          \NameSigPair{\GroupMemberOne}\par
     %           \NameSigPair{\GroupMemberTwo}\par
    %            \NameSigPair{\GroupMemberThree}\par
          %  }
   %         \vspace{20pt}
  %      }
      	 \begin{abstract}
        % 6. Fill in your abstract    
        %	This document is written using one sentence per line.
        %	This allows you to have sensible diffs when you use \LaTeX with version control, as well as giving a quick visual test to see if sentences are too short/long.
        %	If you have questions, ``The Not So Short Guide to LaTeX'' is a great resource (\url{https://tobi.oetiker.ch/lshort/lshort.pdf})
	The application of machine learning to Biochemistry and Biophysics has enabled researchers in this ﬁeld to make remarkable discoveries, such as the generation of new DNA sequences. However, students of Biochemistry and Biophysics do not get the opportunity to learn machine learning. Dr. Victor Hsu of the Oregon State University Biochemistry and Biophysics department has commissioned the Stat Champs to produce an instructional module to give his students the chance to familiarize themselves with machine learning. The software product the Stats Champs have agreed to develop is a web page that allows students to train a machine learning model based on the college basketball statistics and machine learning algorithm of their choosing in order to produce a March Madness bracket. This will help students understand how machine learning algorithms produce models and how inclusion or exclusion of certain data can inﬂuence such models. Over the course of Fall term 2016, the Stat Champs developed materials such as design documents and technology reviews in order to prepare for the engineering of the module. Then, in Winter term 2017, the Stat Champs began the software development phase of this project. In Spring term 2017, the project was finished. This report comprehensively describes the lifecycle of producing the project.
      	\end{abstract}     
 	\end{singlespace}
	%\end{titlepage}
\newpage
%\pagenumbering{arabic}
\tableofcontents
% 7. uncomment this (if applicable). Consider adding a page break.
%\listoffigures
%\listoftables
\clearpage

% 8. now you write!
\section{Introduction}
Biochemistry and Biophysics are two fields that are ripe with many exciting breakthroughs. Machine learning is used by these disciplines to aid their research by providing the ability to generate new sequences of DNA. Our client, Dr. Victor Hsu, is a professor in the Biochemistry and Biophysics department at OSU who recognized that his students should understand machine learning in order to prepare them for their careers. He noticed that the department does not encourage learning machine learning, and that even if they were to, machine learning is a difficult topic for people who haven't been trained in computer science. Additionally, learning machine learning through its application to these fields can be confusing, since machine learned models of DNA can be tough to interpret. Therefore, he commissioned us to produce an online instructional module where his students could grasp machine learning fundamentals in a fun and straightforward manner. To achieve this, he asked us to provide an interface where users could select from men's college basketball statistics and generate a March Madness bracket. In doing so, budding scientists would be able to familiarize themselves with basic machine learning algorithms and also witness how the inclusion or exclusion of data influences the models trained on them. Alex Hoffer developed the GUI, Chongxian Chen implemented machine learning algorithms, and Jacob Smith gathered data for  use. Dr. Hsu's role in the project was supervision only. This report chronicles the lifecycle of the project through Fall, Winter, and Spring terms in 2017.

\section{Original Requirements Document}
\includepdf[pages={1-}]{images/RequirementDoc.pdf}
\newpage
\subsection{Changes from Original Requirements Document}
The majority of requirements outlined in this document did not change. However, some minor changes are noted below.
\subsubsection{New requirements added}
\paragraph{Speed} For the purposes of presenting our project at Expo and to ensure students wouldn't get frustrated waiting for their generated brackets, a new requirement was added that there must be at least one machine learning algorithm that can generate a bracket within two minutes. The \emph{Support Vector Machine} algorithms can do this.
\subsubsection{Change in existing requirements}
\paragraph{Bracket presentation} Users have to click back in their browser to see the bracket they just generated- the module does not automatically do it for them.
\subsubsection{Removal of existing requirements}
\paragraph{Webix} We dropped the use of the JavaScript library Webix for graphical user interface work. It turned out that using such a large and sophisticated library would be overkill for something as simple as printing out a formatted March Madness bracket. Simple web technologies worked just fine.
\paragraph{Player statistics} We dropped the use of player statistics as an option in generating a bracket. We did this because it ended up to be not feasible to write a module that could reference that breadth of data without serious performance hindrances.
\paragraph{API documentation} We got rid of this requirement, because it didn't make any sense to write API documentation when we were exclusively using other APIs. When we involved this requirement, we thought we'd have to write machine learning algorithms in Python by scratch, apparently. Luckily, Scikit-Learn has good API documentation.
\subsection{Revised Gantt Charts}
The three subsequent Gantt Charts were developed for this document in order to elucidate the schedule by which documents were actually produced/milestones were actually reached versus our projected schedule represented by the Gantt Charts in the origial Requirements Document.
\includepdf{images/ganttcharts.pdf}

\section{Original Design Document}
\includepdf[pages={1-}]{images/DesignDoc.pdf}
\subsection{Changes from Original Design Document}

\section{Original Technology Review}
\includepdf[pages={1-}]{images/TechReview.pdf}

\subsection{Changes from Original Technology Review}

\section{Weekly Blog Posts}
\subsection{Alex}
\subsubsection{Fall Term}
\paragraph{\emph{Week 3}}
This week we collaborated with Dr. Hsu and wrote our Project Statement, which he reviewed and signed off on. We submitted the Project Statement at 11 am on 10/14/2016. We did not really encounter any problems, except for maybe some LaTek formatting issues. I am sure the use of LaTek will become easier with more practice. Next week we will be submitting our resumes for peer review and figuring out how to proceed with this project now that we have a clear, working vision to follow.
\paragraph{\emph{Week 4}}
This week we finalized our project statement by revising it to reflect our instructors' suggestions. We also all produced resumes and gave them to classmates for feedback. Next week we will work on our project requirements document and attend Career Fair.
\paragraph{\emph{Week 5}}
This week we attended career fair and developed our project requirements document. Next week we will continue developing this document and will consult the client to get his approval.
\paragraph{\emph{Week 6}}
This week we revised the rough draft of our project requirements document, formatted it using LaTek, and added a Gantt chart. We submitted this requirements document to our client, but as of 3:20 pm have not heard back from him. By the end of the weekend, we hope to have the document signed and submitted. Next week, we will individually work on our tech reviews.
\paragraph{\emph{Week 7}}
This week we revised our project requirements document and began working on our tech review document. Next week we will finish our tech review document.
\paragraph{\emph{Week 8}}
This week we developed our technology review document. We ran into some issues coming up with 3 responsibilities for everybody. We also had some difficulty identifying potential technologies for each of these responsibilities. Next week we will complete our design document.
\paragraph{\emph{Week 9}}
This week we talked about how we would make our design document, and discussed how we would approach recording ourselves for the progress report. We are having some difficulties with design document formatting. We will probably rent out a microphone for use with a computer to record ourselves for the progress report. Next week we will turn in our design document.
\paragraph{\emph{Week 10}}
This week we finished our design document. We will send it to our client and get a signature as soon as possible. We faced difficulty in getting LaTex to properly generate designs like message sequence diagrams. Next week we will submit our progress report and conclude the term.
\subsubsection{Winter Term}
\paragraph{\emph{Week 1}}
This week we came back from winter break and re-calibrated. We voted on a meeting time (Tuesdays) and attended the first class. We look forward to the term.
\paragraph{\emph{Week 2}}
This week we had our first meeting back with our TA. Our meeting consisted of planning out the term for our team. This meant we re-established the responsibilities we set for ourselves individually last term and verbally sketched out an idea of what our Beta release would look like. My own contributions this week were setting up the web page the module will be hosted on and doing some GUI work. The web page can be found here: http://web.engr.oregonstate.edu/~hoffera/CapstoneProject/MachineLearnYourWayToMarchMadnessGlory.html. More to come on the GUI work. Chongxian has set up some machine learning algorithms we can use so next week we will have Jake provide the data to them to see how they operate. After we get a handle on these algorithms, we will begin setting up the module.
\paragraph{\emph{Week 3}}
This week Chongxian arranged the machine learning algorithms, Jake compiled the statistics we'd use in a .csv file, and I worked on the GUI of our web page. Next week we have class on Thursday and wee should have the algorithms being allowed to accept stats as input.
\paragraph{\emph{Week 4}}
This week I continued to polish the GUI for the webpage. Chongxian has selected our machine learning algorithms and Jake has helped him find examples of how to implement them. Jake also gathered a lot of basketball statistics for use in the module. We need to do the OneNote portfolio, a progress report, and a voice-over update by late February.
\paragraph{\emph{Week 5}}
This week we attended class, Chongxian continued developing our machine learning algorithms, Jake continued to gather data, and I continued to develop our GUI. Next week we plan to release an alpha version of our module and we need to create a OneNote, edit our documents, make a status report, and submit these to the OneNote.
\paragraph{\emph{Week 6}}
This week we completed our progress report, both written and presentation versions. I made our OneNote and uploaded all of our documents to it. We had a bit of a hard time filling up all of the required time for the presentation. Next week we will continue development.
\paragraph{\emph{Week 7}}
This week we continued coding. I re-submitted my OneNote to Dr. Winters because it didn't go through the first time. I also met with Dr. Winters to modify my OneNote a bit. We need to finish our coding to be at a beta level release.
\paragraph{\emph{Week 8}}
This week I waited for Jake and Chongxian to make progress. Next week we need to setup a meeting with Dr. Hsu. We also are supposed to be presenting a beta release of our project.
\paragraph{\emph{Week 9}}
This week we did elevator pitches. I have made a draft of our poster using a LaTex conference poster template, and I added a signature page to our progress report and sent it to our client. My two partners should have made progress on integration. Next week I need to polish the poster more and write my new progress report, which I will use the IEEEtran format for.
\subsubsection{Spring Term}
\paragraph{\emph{Week 1}}
This week I went to class to get accustomed to what the term would entail. I updated some CSS on our page. Then, I emailed our client with a link to our project. Hope to hear from him next week and hope to update our poster for Expo.
\paragraph{\emph{Week 2}}
In week 2, Chongxian implemented different algorithms to choose from. We all updated the poster and submitted our new draft. We also emailed our client again with our finished product and our draft for him to sign off on. We await his response. In the coming weeks, we need his sign-off on the poster and then we have Expo.
\paragraph{\emph{Week 3}}
This week we attended class. I went to Dr. Hsu's office to talk to him about signing off on our posters. We also pushed our code to the Github repo. Our poster final is due May 1.
\paragraph{\emph{Week 4}}
This week I modified our poster to match our client's suggestions, then McGrath's suggestions. Then, I submitted the poster for printing. Next week I need to do the WIRED assignment.
\paragraph{\emph{Week 5}}
This week I interviewed Brandon Chatham for the WIRED assignment. We are preparing for Expo.
\paragraph{\emph{Week 6}}
This week we got our spring term progress report ready. Expo is next week and we're preparing.
\paragraph{\emph{Week 7}}
This week we had Expo. Term's almost over. In the remaining three weeks we need to edit our original docs, finish 3 small writing assignments, and do a final progress report.
\subsection{Chongxian}

\subsection{Jake}

\newpage
\section{Final Poster}
\includepdf{images/Group59Poster.pdf}
\newpage

\section{Project Documentation}
We were both lucky and unlucky to be assigned a project that did not make well-detailed documentation a necessary responsibility. We were lucky in the sense that this shaved off a lot of work we would have to do, and unlucky in the sense that this project did not expose us to how to properly write documentation.
\subsection{How the project works}
\begin{tikzpicture}[node distance=2cm]
\node (start) [startstop] {User visits page};
\node (input1) [io, below of=start] {User selects algorithm};
\node (input2) [io, right of=input1, xshift=6cm] {User selects stats};
\node (process1) [process, below of=input2] {Scikit-Learn works on data};
\node (output1) [io, below of=process1] {Scikit-Learn bracket generated};
\node (stop) [startstop, below of=output1] {User reloads main page};
\draw [arrow] (start) -- (input1);
\draw [arrow] (input1) -- (input2);
\draw [arrow] (input2) -- (process1);
\draw [arrow] (process1) -- (output1);
\draw [arrow] (output1) -- (stop);
\end{tikzpicture}

\subsection{How to use the software}
No installation is necessary. To use our software, all a user has to do is go to this website: http://web.engr.oregonstate.edu/~hoffera/CapstoneProject/MachineLearnYourWayToMarchMadnessGlory.html. On this site, a link to the machine learning module is posted. The module is compatible across all browsers. There are instructions on how to use the module on this site, as well as on the page where the module is hosted itself. To use the module, the user clicks on one machine learning algorithm and any number of the provided statistical categories and submits their choices. Then, a waiting period ranging from two minutes for simple machine learning algorithms to many hours for more precise algorithms is required. A message displays on the screen to inform the user they must wait. Then, the user is informed when the bracket has been generated. Finally, the user returns to the module page to see their generated bracket presented. The user can repeat this process an arbitrary number of times to generate an arbitrary number of brackets, but of course, the amount of time it takes to utilize certain machine learning algorithms is an important constraint the user must consider.
\subsection{Requirements for usage}
No special hardware, operating system, or runtime requirements dictate the usage of this module. As stated previously, any browser on any operating system with internet access can utilize the module.
\subsection{API Documentation}
We were not asked to document any API, and do not have any user guides. Such documents would not be particularly useful to any programmers because our module uses Scikit-Learn. This means that the API has already been documented for us by the fine people at Scikit-Learn. This documentation can be found here: http://scikit-learn.org/stable/documentation.html.

\section{How We Learned New Technology}
\subsection{Alex}
\paragraph{\emph{Websites}}
\begin{itemize}
\item https://stackoverflow.com/ 
\item https://www.w3schools.com/js/
\item http://scikit-learn.org/stable/documentation.html
\end{itemize}
Stack Overflow was most valuable because it provided useful information on debugging small issues with web development. W3 Schools was second to this, because it gave me a lot of insight on how to use JavaScript to make a website \emph{pop}. JavaScript is one of my weaker languages, so I needed it to make sure I was doing the right things. Finally, the documentation for Scikit-Learn was of course valuable for the inclusion of machine learning algorithms, but is listed last because implementation of machine learning algorithms was primarily Chongxian's responsibility.
\paragraph{\emph{People}}
Several people on campus were tremendously helpful in providing information that we needed. We owe a debt to our teaching assistant Xinze Guan for recommending Scikit-Learn for machine learning algorithm implementation. Our client, Dr. Victor Hsu, was also useful in this regard. We also relied on our instructor Kevin McGrath's LaTeX templates and Makefiles and Dr. Kirsten Winters' writing advice. Finally, my teammates helped me learn a lot of new and exciting technologies, with Jake demonstrating to me proper usage of LaTeX and Chongxian for exploring Scikit-Learn and elucidating a lot of its mysteries to me. 
\section{What We Learned}
\subsection{Alex}
\paragraph{\emph{Technical Information}}
In terms of web development, I learned more JavaScript and polished my HTML/CSS abilities. I became acquainted with how Amazon Web Services works and what their limits on their free service are. I also learned a little on how to write embedded Python, how to use Scikit-Learn in Python, and how to use Python to scrape data from websites. Since these were not my primary responsibilities, though, I didn't learn them as well as I would've liked. Finally, I learned how to use LaTeX, proper usage of the IEEETran format, and the mathematical underpinnings of various machine learning algorithms.

\paragraph{\emph{Non-Technical Information}}
I learned how to interact with a software client. I also learned how to take an idea and move it through the necessary phases of development, including requirements, planning, and design phases all the way to implementation, maintenance, and presentation. Essentially, I learned the engineering practices necessary to develop a project from embryo to adulthood, and learned how to sell or pitch an idea.
\paragraph{\emph{Project Work}}
I learned that a project must run on a well-defined schedule. If each milestone of a project builds on a previous one, this is especially important. Without a rigid schedule, you fall behind sooner rather than later and the versions of your project you will release will be fraught with bugs. 

\paragraph{\emph{Project Management}}
I learned that in a team setting, somebody has to be the team manager (whether de facto or not), otherwise milestones won't be reached and the project will be delivered late. 

\paragraph{\emph{Working in Teams}}
I discovered certain methods for overcoming differences in work style. Some people procrastinate, others get work done early. There's nothing wrong with either approach, but if you're in a team where there are conflicting philosophies, you need to find out early how to bridge the gap between you and your group mates.

\paragraph{\emph{What I would do differently}}
I would choose different responsibilities for this project. I wish I could've done more of the machine learning aspects, rather than simply oversee Chongxian's progress. I would've considered using something besides Scikit-Learn  because I would've liked to have used more exotic machine learning algorithms, or at the very least neural networks, which are not supported in Scikit-Learn.


\subsection{Chongxian}
\subsection{Jacob}

\appendices
\section{Essential Code Listings}
\label{EssentialCodeListings}
\begin{lstlisting}[caption={MachineLearnYourWayToMarchMadnessGlory.html. The graphical user interface that provides users information on how to engage with the module, a link to the module, and information about our project.}]
<!DOCTYPE html>
<html lang="en">

<!-- Page Title, CSS, JavaScript files to load in, etc. -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Machine Learn Your Way to March Madness Glory!</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300
italic,400italic,600italic,700italic,800italic,400,300,600,
700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,
300,300italic,400italic,700,700italic,900,900italic' 
rel='stylesheet' type='text/css'>

    <!-- Plugin CSS -->
    <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

    <!-- Theme CSS -->
    <link href="css/creative.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<!-- Header stuff. Navigation buttons. -->

<body id="page-top">

    <nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" 
data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">Home</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a class="page-scroll" href="#about">Instructions</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#services">Module</a>
                    </li>
		
		    <li>
			<a class="page-scroll" href="#portfolio">Purpose</a>
		    </li>

                    <li>
                        <a class="page-scroll" href="#contact">About</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

	<!-- Title and content for first page presented. -->

    <header>
        <div class="header-content">
            <div class="header-content-inner">
                <h1 id="homeHeading">Machine Learn Your Way to March Madness Glory!</h1>
                <hr>
                <a href="#about" class="btn btn-primary btn-xl page-scroll">How to Use This Module</a>
            </div>
        </div>
    </header>

	<!-- Instructions Section -->

    <section class="bg-primary" id="about">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    <h2 class="section-heading">How to Use This Module</h2>
                    <hr class="light">
                    <p class="text-faded">To generate a machine learned March Madness bracket, click on the Load 
the Module button below. You will be asked to 
click on a link that will take you to the module. 
From there, select one or more statistical 
categories to train the bracket on from the 
box at the top left of the page. 
Allow the module two minutes 
to generate a machine learned bracket.</p>
                    <a href="#services" class="page-scroll btn btn-default btn-xl sr-button">Load the Module</a>
                </div>
            </div>
        </div>
    </section>

	<!-- Module Section -->

    <section id="services">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Module</h2>
			<a href="http://crtour.xyz/CapstoneProject/V2/select.php">Click here to load the module.</a>
                    <hr class="primary">
		    <a href="#portfolio" class="btn btn-primary btn-xl page-scroll">Purpose of module</a>
                </div>
            </div>
        </div>         
	</section>

	<!-- Purpose Section -->

	<section class="no-padding" id="portfolio">
        <aside class="bg-dark">
        <div class="container text-center">
            <div class="call-to-action">
                <h2>Purpose of Module</h2>
		<p> This is an instructional tool intended to teach 
students of Biochemistry and Biophysics at Oregon State 
University machine learning concepts. Since machine learning 
leads to remarkable discoveries in the fields of biochemistry 
and biophysics, it is important students in this discipline 
are able to understand how the inclusion or exclusion of 
specific data sets influences a resulting model. 
Rather than learn machine learning through its application 
to biochemistry/biophysics (which would be especially 
challenging), this module teaches students machine learning 
through something that is simple.</p>
                <a href="#contact" class="page-scroll btn btn-default btn-xl 
sr-button">About the developers</a>
            </div>
        </div>
    </aside>
    </section>

	<!-- About Section -->


       <section id="contact">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    <h2 class="section-heading">About the Developers</h2>
                    <hr class="primary">
                    <p>The developers of this module are Alex Hoffer, 
Chongxian Chen, and Jacob Smith. We developed this 
project for our Computer Science Senior Capstone course, 
in the 2016-2017 year. Our instructor was D. Kevin McGrath. 
If you need to get in touch with us, please click the link below.</p>
                </div>
                
		<!-- Email subsection -->

                <div class="col-lg-4 text-center">
                    <i class="fa fa-envelope-o fa-3x sr-contact"></i>
                    <p><a href="mailto:hoffera@oregonstate.edu">Contact Alex Hoffer</a></p>
                </div>
            </div>
        </div>
    </section>

    <!-- jQuery -->
    <script src="vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="vendor/scrollreveal/scrollreveal.min.js"></script>
    <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

    <!-- Theme JavaScript -->
    <script src="js/creative.min.js"></script>

</body>

</html>
\end{lstlisting}
\begin{lstlisting}[caption={mm.py, where basketball statistics are read and fed into Scikit-Learn machine learning algorithms. Then, the resulting March Madness bracket is generated.}]
"""
This tool
"""
import pandas as pd
import math
from sklearn import model_selection, linear_model, svm, naive_bayes
from sklearn.naive_bayes import GaussianNB, MultinomialNB
import csv
import random
import sys
sys.path.append('./predicted_bracket_generator')
from bracket_builder import make_bracket

base_elo = 1600
team_elos = {}  # Reset each year.
team_stats = {}
X = []
y = []
submission_data = []
folder = 'input'
prediction_year = 2017
start_year = 2016

def calc_elo(win_team, lose_team, season):
    winner_rank = get_elo(season, win_team)
    loser_rank = get_elo(season, lose_team)

    """
    This is originally from from:
    http://zurb.com/forrst/posts/An_Elo_Rating_function_in_Python_written_for_foo-hQl
    """
    rank_diff = winner_rank - loser_rank
    exp = (rank_diff * -1) / 400
    odds = 1 / (1 + math.pow(10, exp))
    if winner_rank < 2100:
        k = 32
    elif winner_rank >= 2100 and winner_rank < 2400:
        k = 24
    else:
        k = 16
    new_winner_rank = round(winner_rank + (k * (1 - odds)))
    new_rank_diff = new_winner_rank - winner_rank
    new_loser_rank = loser_rank - new_rank_diff

    return new_winner_rank, new_loser_rank


def initialize_data():
    for i in range(start_year, prediction_year+1):
        team_elos[i] = {}
        team_stats[i] = {}


def get_elo(season, team):
    try:
        return team_elos[season][team]
    except:
        try:
            # Get the previous season's ending value.
            team_elos[season][team] = team_elos[season-1][team]
            return team_elos[season][team]
        except:
            # Get the starter elo.
            team_elos[season][team] = base_elo
            return team_elos[season][team]


def predict_winner(team_1, team_2, model, season, stat_fields):
    features = []

    # Team 1
    features.append(get_elo(season, team_1))
    for stat in stat_fields:
        features.append(get_stat(season, team_1, stat))

    # Team 2
    features.append(get_elo(season, team_2))
    for stat in stat_fields:
        features.append(get_stat(season, team_2, stat))

    return model.predict_proba([features])


def update_stats(season, team, fields):
    """
    This accepts some stats for a team and udpates the averages.
    First, we check if the team is in the dict yet. If it's not, we add it.
    Then, we try to check if the key has more than 5 values in it.
        If it does, we remove the first one
        Either way, we append the new one.
    If we can't check, then it doesn't exist, so we just add this.
    Later, we'll get the average of these items.
    """
    if team not in team_stats[season]:
        team_stats[season][team] = {}

    for key, value in fields.items():
        # Make sure we have the field.
        if key not in team_stats[season][team]:
            team_stats[season][team][key] = []

        if len(team_stats[season][team][key]) >= 9:
            team_stats[season][team][key].pop()
        team_stats[season][team][key].append(value)


def get_stat(season, team, field):
    try:
        l = team_stats[season][team][field]
        return sum(l) / float(len(l))
    except:
        return 0


def build_team_dict():
    team_ids = pd.read_csv(folder + '/Teams.csv')
    team_id_map = {}
    for index, row in team_ids.iterrows():
        team_id_map[row['Team_Id']] = row['Team_Name']
    return team_id_map


def build_season_data(all_data):
    # Calculate the elo for every game for every team, each season.
    # Store the elo per season so we can retrieve their end elo
    # later in order to predict the tournaments without having to
    # inject the prediction into this loop.
    print("Building season data.")
    for index, row in all_data.iterrows():
        # Used to skip matchups where we don't have usable stats yet.
        skip = 0

        # Get starter or previous elos.
        team_1_elo = get_elo(row['Season'], row['Wteam'])
        team_2_elo = get_elo(row['Season'], row['Lteam'])

        # Add 100 to the home team (# taken from Nate Silver analysis.)
        if row['Wloc'] == 'H':
            team_1_elo += 100
        elif row['Wloc'] == 'A':
            team_2_elo += 100

        # We'll create some arrays to use later.
        team_1_features = [team_1_elo]
        team_2_features = [team_2_elo]

        # Build arrays out of the stats we're tracking..
        for field in stat_fields:
            team_1_stat = get_stat(row['Season'], row['Wteam'], field)
            team_2_stat = get_stat(row['Season'], row['Lteam'], field)
            if team_1_stat is not 0 and team_2_stat is not 0:
                team_1_features.append(team_1_stat)
                team_2_features.append(team_2_stat)
            else:
                skip = 1

        if skip == 0:  # Make sure we have stats.
            # Randomly select left and right and 0 or 1 so we can train
            # for multiple classes.
            if random.random() > 0.5:
                X.append(team_1_features + team_2_features)
                y.append(0)
            else:
                X.append(team_2_features + team_1_features)
                y.append(1)

        # AFTER we add the current stuff to the prediction, update for
        # next time. Order here is key so we don't fit on data from the
        # same game we're trying to predict.
        if row['Wfta'] != 0 and row['Lfta'] != 0:
            stat_1_fields = {
                'score': row['Wscore'],
                'fgp': row['Wfgm'] / row['Wfga'] * 100,
                'fga': row['Wfga'],
                'fga3': row['Wfga3'],
                '3pp': row['Wfgm3'] / row['Wfga3'] * 100,
                'ftp': row['Wftm'] / row['Wfta'] * 100,
                'or': row['Wor'],
                'dr': row['Wdr'],
                'ast': row['Wast'],
                'to': row['Wto'],
                'stl': row['Wstl'],
                'blk': row['Wblk'],
                'pf': row['Wpf']
            }
            stat_2_fields = {
                'score': row['Lscore'],
                'fgp': row['Lfgm'] / row['Lfga'] * 100,
                'fga': row['Lfga'],
                'fga3': row['Lfga3'],
                '3pp': row['Lfgm3'] / row['Lfga3'] * 100,
                'ftp': row['Lftm'] / row['Lfta'] * 100,
                'or': row['Lor'],
                'dr': row['Ldr'],
                'ast': row['Last'],
                'to': row['Lto'],
                'stl': row['Lstl'],
                'blk': row['Lblk'],
                'pf': row['Lpf']
            }
            update_stats(row['Season'], row['Wteam'], stat_1_fields)
            update_stats(row['Season'], row['Lteam'], stat_2_fields)

        # Now that we've added them, calc the new elo.
        new_winner_rank, new_loser_rank = calc_elo(
            row['Wteam'], row['Lteam'], row['Season'])
        team_elos[row['Season']][row['Wteam']] = new_winner_rank
        team_elos[row['Season']][row['Lteam']] = new_loser_rank

    return X, y


if __name__ == "__main__":
	#choose model
    if len(sys.argv) > 1:
    	if sys.argv[1] == '1':
    		print("You choose linear logistic regression to be the model")
    		model = linear_model.LogisticRegression()
    	elif sys.argv[1] == '2':
    		print("You choose svm rbf to be the model")
    		model = svm.SVC(gamma=0.001, C=100., probability=True, kernel='rbf')
    	elif sys.argv[1] == '3':
    		print("You choose svm linear to be the model")
    		model = svm.SVC(gamma=0.001, C=100., probability=True, kernel='linear')
    	elif sys.argv[1] == '4':
    		print("You choose svm poly to be the model")
    		model = svm.SVC(gamma=0.001, C=100., probability=True, kernel='poly')
    	elif sys.argv[1] == '5':
    		print("You choose svm sigmoid to be the model")
    		model = svm.SVC(gamma=0.001, C=100., probability=True, kernel='sigmoid')
        elif sys.argv[1] == '6':
            print("You choose Niave Bayes Gaussian to be the model")
            model = GaussianNB()
        elif sys.argv[1] == '7':
            print("You choose Niave Bayes multinomial models to be the model")
            model = MultinomialNB()
        else:
            model = linear_model.LogisticRegression()
            print("You choose linear logistic regression to be the model")  
    else:
    	model = linear_model.LogisticRegression()
    	print("You choose linear logistic regression to be the model")
    
    #choose fields
    if len(sys.argv) > 2:
    	stat_fields = sys.argv[2:]
    	print("You choose ", str(sys.argv[2:]), " as the feature to be considered")
    else:
    	stat_fields = ['score', 'fga', 'fgp', 'fga3', '3pp', 'stl']
    	print("You choose 'score', 'fga', 'fgp', 'fga3', '3pp', 'stl' as the feature to be considered")

    	#stat_fields = ['score', 'fga', 'fgp', 'fga3', '3pp', 'ftp', 'or', 'dr',
    	#'ast', 'to', 'stl', 'blk', 'pf']

    initialize_data()
    season_data = pd.read_csv(folder + '/RegularSeasonDetailedResults.csv')
    season_data = season_data[season_data['Season']>=start_year]
    tourney_data = pd.read_csv(folder + '/TourneyDetailedResults.csv')
    tourney_data = tourney_data[tourney_data['Season']>=start_year]
    frames = [season_data, tourney_data]
    all_data = pd.concat(frames)

    # Build the working data.
    X, y = build_season_data(all_data)

    # Fit the model.
    print("Fitting on %d samples." % len(X))

    # Check accuracy.
    print("Doing model selection.")
    print(model_selection.cross_val_score(
        model, X, y, cv=10, scoring='accuracy', n_jobs=-1
    ).mean())

    model.fit(X, y)

    # Now predict tournament matchups.
    print("Getting teams.")
    seeds = pd.read_csv(folder + '/TourneySeeds.csv')
    # for i in range(2016, 2017):
    tourney_teams = []
    for index, row in seeds.iterrows():
        if row['Season'] == prediction_year:
            tourney_teams.append(row['Team'])

    # Build our prediction of every matchup.
    print("Predicting matchups.")
    tourney_teams.sort()
    for team_1 in tourney_teams:
        for team_2 in tourney_teams:
            if team_1 < team_2:
                prediction = predict_winner(
                    team_1, team_2, model, prediction_year, stat_fields)
                label = str(prediction_year) + '_' + str(team_1) + '_' + \
                    str(team_2)
                submission_data.append([label, prediction[0][0]])

    # Write the results.
    print("Writing %d results." % len(submission_data))
    with open(folder + '/submission.csv', 'w') as f:
        writer = csv.writer(f)
        writer.writerow(['id', 'pred'])
        writer.writerows(submission_data)

    # Now so that we can use this to fill out a bracket, create a readable
    # version.
    print("Outputting readable results.")
    team_id_map = build_team_dict()
    readable = []
    less_readable = []  # A version that's easy to look up.
    for pred in submission_data:
        parts = pred[0].split('_')
        less_readable.append(
            [team_id_map[int(parts[1])], team_id_map[int(parts[2])], pred[1]])
        # Order them properly.
        if pred[1] > 0.5:
            winning = int(parts[1])
            losing = int(parts[2])
            proba = pred[1]
        else:
            winning = int(parts[2])
            losing = int(parts[1])
            proba = 1 - pred[1]
        readable.append(
            [
                '%s beats %s: %f' %
                (team_id_map[winning], team_id_map[losing], proba)
            ]
        )
    with open(folder + '/readable-predictions.csv', 'w') as f:
        writer = csv.writer(f)
        writer.writerows(readable)
    with open(folder + '/less-readable-predictions.csv', 'w') as f:
        writer = csv.writer(f)
        writer.writerows(less_readable)

    print("Generating pictures.")
    generatorPath = "./predicted_bracket_generator/"
    DATAPATH = generatorPath+"data/"
    submissionPath = folder+'/submission.csv'
    emptyBracketPath = generatorPath+'/empty_bracket.jpg'
    outputFilePath = 'predicted_bracket.jpg'

    make_bracket(DATAPATH, submissionPath, emptyBracketPath, outputFilePath)
\end{lstlisting}

\end{document}
